# 2025-06-30

## Blackjack Keyboard Bug - Continued

### Problem Identified
The keyboard bridge causes the iframe to resize to 1x600 pixels, which triggers the canvas to go black. This happens because:
1. Parent sends keyboard event via postMessage
2. ~5 seconds later, something causes iframe resize
3. sizeHandler detects bad dimensions (1 x 600)
4. Canvas clears/redraws incorrectly

### Fixes Applied (waiting for Vercel cache)

**ctl_utils.js** - Added iframe detection to prevent bad resize:
```javascript
var bInIframe = (window.self !== window.top);
if (bInIframe) {
    // Force fixed dimensions when in iframe
    w = 800;
    h = 600;
}
// Also skip visualViewport when in iframe (line 214)
```

**Arcade.tsx** - Added cache bust to iframe URL:
```javascript
const cacheBust = 'v=20260201b';
```

**vercel.json** - Added to disable JS caching:
```json
{
  "headers": [{ "source": "/js/(.*)", "headers": [{ "key": "Cache-Control", "value": "public, max-age=0, must-revalidate" }] }]
}
```

### Current Status
- ✅ Mouse works perfectly
- ❌ Keyboard still triggers black screen
- ❌ Vercel CDN caching old JS files
- Fix is in code, waiting for cache to clear or manual redeploy

### Next Steps
- Option 1: Manual redeploy from Vercel dashboard
- Option 2: Wait for cache to expire (hours)
- Option 3: Vercel CLI cache purge
